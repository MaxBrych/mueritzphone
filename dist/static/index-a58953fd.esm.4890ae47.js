import{r as l,j as o,aV as ae,aR as G,bh as ie,aW as ce,d3 as ue,ad as V,af as le,aj as de,b5 as pe,e as R,a4 as me,d4 as fe,aq as he,d5 as ye,d6 as ge,d7 as be,bO as Te,ca as Pe,ak as Y,a2 as F,aP as N,aH as Le,c0 as Ie,aG as j,aF as C,aS as Oe,$ as Se,bp as xe,d8 as Re,aN as M,a5 as ve,ab as je,ac as _e,bt as $,d9 as we,da as Ce,db as De,dc as Ee,bn as k,d as Fe,dd as $e,cG as Ae,cH as Ne,br as Me,de as ke,df as qe,c4 as q,c6 as We,dg as Be,bX as He,bu as Ue,by as Ge,dh as Ve,di as Ye,dj as Ke,bY as Xe}from"./sanity.c38ca016.js";import{u as ze,c as W,b as Qe}from"./index-71beeb8c.esm.3cd07265.js";import{P as Je}from"./PaneItem-e34be016.esm.ea287301.js";import"./index.f553bc31.js";function B(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?B(Object(t),!0).forEach(function(r){Ze(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Ze(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const H=100,A=2e3,K={by:[{field:"_updatedAt",direction:"desc"}]},et={};function tt(e,n){return e._id?Y(e._id):"item-".concat(n)}function nt(e){return De(e).map(n=>{const t=n.draft||n.published;return f(f({},t),{},{hasPublished:!!n.published,hasDraft:!!n.draft})})}const rt=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function st(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.match(rt);if(!t)return null;const r=(t[1]||t[2]).trim().replace(/^["']|["']$/g,"");if(r[0]==="$"){const a=r.slice(1),c=n[a];return typeof c=="string"?c:null}return r}function ot(e){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(e.trim())}function at(e){return e.map(n=>[it(n),(n.direction||"").toLowerCase()].map(t=>t.trim()).filter(Boolean).join(" ")).join(",")}function it(e){return e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field}function ct(e,n){const t=e.by.map(r=>{if(r.mapWith)return r;const a=ut(n,r.field);return a?dt(a,"datetime")?f(f({},r),{},{mapWith:"dateTime"}):a.jsonType==="string"?f(f({},r),{},{mapWith:"lower"}):r:r});return t.every((r,a)=>r===e.by[a])?e:f(f({},e),{},{by:t})}function ut(e,n){const t=he(n);let r=e;for(const a of t){if(!r)return;if(typeof a=="string"){r=lt(r,a);continue}if(!(ye(a)||ge(a))||r.jsonType!=="array")return;const[s,i]=r.of||[];if(i||!s)return;if(!be(s)){r=s;continue}const[h,y]=s.to||[];if(y||!h)return;r=h}return r}function lt(e,n){if(!("fields"in e))return;const t=e.fields.find(r=>r.name===n);return t?t.type:void 0}function dt(e,n){let t=e.type;for(;t;){if(t.name===n||!t.type&&t.jsonType===n)return!0;t=t.type}return!1}function pt(e){const{childItemId:n,error:t,filterIsSimpleTypeContraint:r,fullList:a,isActive:c,isLoading:s,items:i,layout:h,onListChange:y,onRetry:u,showIcons:g}=e,O=V(),{collapsed:I}=Te(),{collapsed:L,index:b}=Pe(),[S,x]=l.exports.useState(!1);l.exports.useEffect(()=>{if(L)return;const d=setTimeout(()=>{x(!0)},0);return()=>{clearTimeout(d)}},[L]);const T=l.exports.useCallback(d=>{const P=Y(d._id),p=n===P;return o(Je,{icon:g===!1?!1:void 0,id:P,pressed:!c&&p,selected:c&&p,layout:h,schemaType:O.get(d._type),value:d})},[n,c,h,O,g]),m=l.exports.useMemo(()=>{if(!S)return null;if(t)return o(F,{align:"center",direction:"column",height:"fill",justify:"center",children:o(N,{width:1,children:R(Le,{paddingX:4,paddingY:5,space:4,children:[o(Ie,{as:"h3",children:"Could not fetch list items"}),R(j,{as:"p",children:["Error: ",o("code",{children:t.message})]}),u&&o(C,{children:o(G,{icon:Oe,onClick:u,text:"Retry",tone:"primary"})})]})})});if(i===null)return o(F,{align:"center",direction:"column",height:"fill",justify:"center",children:o(Qe,{ms:300,children:R(Se,{children:[o(xe,{muted:!0}),o(C,{marginTop:3,children:o(j,{align:"center",muted:!0,size:1,children:"Loading documents\u2026"})})]})})});if(!s&&i.length===0)return o(F,{align:"center",direction:"column",height:"fill",justify:"center",children:o(N,{width:1,children:o(C,{paddingX:4,paddingY:5,children:o(j,{align:"center",muted:!0,size:2,children:r?"No documents of this type":"No matching documents"})})})});const d=a&&i.length===A;return R(C,{padding:2,children:[i.length>0&&o(Re,{gap:1,getItemKey:tt,items:i,renderItem:T,onChange:y},"".concat(b,"-").concat(L)),s&&o(M,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:o(j,{align:"center",muted:!0,size:1,children:"Loading\u2026"})}),d&&o(M,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:R(j,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",A," documents"]})})]})},[t,r,a,y,s,i,u,T,S,L,b]);return o(ve,{overflow:I?void 0:"auto",children:m})}const X=l.exports.memo(e=>{let{index:n,initialValueTemplates:t=[],menuItems:r=[],menuItemGroups:a=[],setLayout:c,setSortOrder:s,title:i}=e;const{features:h}=ze(),y=l.exports.useMemo(()=>({setLayout:u=>{let{layout:g}=u;c(g)},setSortOrder:u=>{s(u)}}),[c,s]);return o(ae,{backButton:h.backButton&&n>0&&o(G,{as:ie,"data-as":"a",icon:ce,mode:"bleed"}),title:i,actions:o(ue,{initialValueTemplateItems:t,actionHandlers:y,menuItemGroups:a,menuItems:r})})});X.displayName="DocumentListPaneHeader";const mt={result:null,error:!1},ft=e=>({result:{documents:e},loading:!1,error:!1}),ht=e=>({result:null,loading:!1,error:e}),yt=function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Ee,r=t.next.bind(t);return e.pipe(k(s=>({client:s.client,query:s.query,params:s.params})),Fe($e),Ae(1),Ne()).pipe(Me(s=>{const i=ke(s.client,s.query,s.params,n).pipe(k(ft),qe());return q($({loading:!0}).pipe(We(400),Be(i)),i)})).pipe(He(mt),Ue((s,i)=>Ge($(ht(s)),q(Ve(window,"online"),t).pipe(Ye(1),Ke(i)))),Xe((s,i)=>f(f(f({},s),i),{},{onRetry:r})))};function gt(e){var n;const{apiVersion:t,filter:r,params:a,sortOrder:c}=e,s=je(_e),[i,h]=l.exports.useState(!1),y=l.exports.useRef(i),[u,g]=l.exports.useState(null),O=(u==null?void 0:u.error)||null,I=(u==null?void 0:u.loading)||u===null,L=u==null?void 0:u.onRetry,b=(n=u==null?void 0:u.result)==null?void 0:n.documents,S=l.exports.useMemo(()=>b?nt(b):null,[b]),x=l.exports.useMemo(()=>{const m=c==null?void 0:c.extendedProjection,d=["_id","_type"],P=d.join(","),p=(c==null?void 0:c.by)||[],v=i?A:H,_=p.length>0?p:K.by,w=at(_);if(m){const D=d.concat(m).join(",");return["*[".concat(r,"] {").concat(D,"}"),"order(".concat(w,") [0...").concat(v,"]"),"{".concat(P,"}")].join("|")}return"*[".concat(r,"]|order(").concat(w,")[0...").concat(v,"]{").concat(P,"}")},[r,i,c]),T=l.exports.useCallback(m=>{let{toIndex:d}=m;I||y.current||d>=H/2&&(h(!0),y.current=!0)},[I]);return l.exports.useEffect(()=>{const m=i?p=>Boolean(p.result):()=>!0;g(p=>p?f(f({},p),{},{loading:!0}):null);const P=yt($({client:s,query:x,params:a}),{apiVersion:t,tag:"desk.document-list"}).pipe(we(m)).subscribe(g);return()=>P.unsubscribe()},[t,s,i,x,a]),l.exports.useEffect(()=>{g(null),h(!1),y.current=!1},[r,a,c,t]),{error:O,fullList:i,handleListChange:T,isLoading:I,items:S,onRetry:L}}const U=[];function bt(e){const n=l.exports.useRef(e);return Ce(n.current,e)||(n.current=e),n.current}const Ot=l.exports.memo(function(n){const{childItemId:t,index:r,isActive:a,isSelected:c,pane:s,paneKey:i}=n,h=V(),{name:y}=le(),{defaultLayout:u="default",displayOptions:g,initialValueTemplates:O=U,menuItems:I,menuItemGroups:L,options:b,title:S}=s,{apiVersion:x,defaultOrdering:T=U,filter:m}=b,d=bt(b.params||et),P=s.source,p=l.exports.useMemo(()=>st(m,d),[m,d]),v=(g==null?void 0:g.showIcons)!==!1,[_,w]=W(p,"layout",u),D=l.exports.useMemo(()=>(T==null?void 0:T.length)>0?{by:T}:K,[T]),[E,z]=W(p,"sortOrder",D),Q=p&&E?ct(E,h.get(p)):E,J=de(Q),Z=ot(m),{error:ee,fullList:te,handleListChange:ne,isLoading:re,items:se,onRetry:oe}=gt({filter:m,params:d,sortOrder:J,apiVersion:x});return o(pe,{name:P||y,children:R(me,{currentMaxWidth:350,id:i,maxWidth:640,minWidth:320,selected:c,children:[fe,o(X,{index:r,initialValueTemplates:O,menuItems:I,menuItemGroups:L,setLayout:w,setSortOrder:z,title:S}),o(pt,{childItemId:t,error:ee,filterIsSimpleTypeContraint:Z,fullList:te,isActive:a,isLoading:re,items:se,layout:_,onListChange:ne,onRetry:oe,showIcons:v})]})})});export{Ot as default};
